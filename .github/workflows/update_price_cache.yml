# Here is the updated YAML configuration for the workflow:

name: Update Price Cache

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  update-price-cache:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python 3.9
      uses: actions/setup-python@v2
      with:
        python-version: 3.9

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Build complete price cache
      run: python build_complete_price_cache.py
      continue-on-error: true

    - name: Verify required tickers
      run: |
        python -c """
import pandas as pd
import sys

REQUIRED_TICKERS = {'TICKER1', 'TICKER2', 'TICKER3'}  # Update with actual required tickers
FILE_PATH = 'data/cache/prices_cache.parquet'

def check_tickers():
    try:
        df = pd.read_parquet(FILE_PATH)
        current_tickers = set(df['ticker'].unique())
        missing_tickers = REQUIRED_TICKERS - current_tickers
        coverage = (len(REQUIRED_TICKERS - missing_tickers) / len(REQUIRED_TICKERS)) * 100

        print(f"Required Tickers Summary: {REQUIRED_TICKERS}")
        print(f"Optional Degradation Summary: Missing Tickers: {missing_tickers}")
        if missing_tickers or coverage < 100:
            sys.exit(1)
    except Exception as e:
        print(f"Error: {e}")
        sys.exit(1)

check_tickers()
"""
