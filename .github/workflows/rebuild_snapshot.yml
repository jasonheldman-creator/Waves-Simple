name: Rebuild Snapshot

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
    - name: Run rebuild snapshot script
      run: |
        python3 scripts/rebuild_snapshot.py
        git add data/live_snapshot.csv
        git commit -m 'Regenerate snapshot' --allow-empty

        # Time-stamped commit
        GIT_COMMITTER_DATE='$(date -u)' git commit --amend --no-edit --date '$(date -u)' --allow-empty
        
        # Force commit by checking out the branch again
        git checkout -B main
        git push origin main
