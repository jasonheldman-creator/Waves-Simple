def compute_portfolio_snapshot(portfolio, mode=None):
    # Previous code logic here
    pass