def compute_portfolio_snapshot_from_truth(..., mode: str | None = None):
    # Existing logic
    ...
    return compute_portfolio_snapshot(..., mode=mode)